<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>

  <link rel="stylesheet"
        href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"/>
  <link rel="stylesheet"
        href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"/>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">

  <script src="https://unpkg.com/lucide@latest"></script>
  <script>
    lucide.createIcons();
  </script>


  <title>{% block title %}Admin Panel{% endblock %}</title>
</head>

<body>

<div class="app-shell">

  <!-- ===== ADMIN SIDEBAR ===== -->
  <aside class="sidebar-dark">

    <div class="sidebar-brand">
      <span class="dot"></span>
      <span>TASK AND TELECONFERENCE SYSTEM</span>
    </div>

    <div class="sidebar-nav">

      <!-- MAIN -->
      <div class="sidebar-section">MAIN</div>

      <a class="sidebar-link {% if request.endpoint == 'views.admin_dashboard' %}active{% endif %}"
         href="{{ url_for('views.admin_dashboard') }}">
        <i data-lucide="layout-dashboard" class="sidebar-icon" aria-hidden="true"></i>
        <span>Dashboard</span>
      </a>

      <!-- ADMIN MODULES -->
      <div class="sidebar-section">ADMIN MODULES</div>

      <a class="sidebar-link {% if request.endpoint == 'views.manage_tasks' %}active{% endif %}"
         href="{{ url_for('views.manage_tasks') }}">
        <i data-lucide="check-square" class="sidebar-icon" aria-hidden="true"></i>
        <span>Manage Tasks</span>
      </a>

      <a class="sidebar-link {% if request.endpoint == 'views.manage_meetings' %}active{% endif %}"
         href="{{ url_for('views.manage_meetings') }}">
        <i data-lucide="calendar-days" class="sidebar-icon" aria-hidden="true"></i>
        <span>Manage Meetings</span>
      </a>

      <a class="sidebar-link {% if request.endpoint == 'views.monitoring_panel' %}active{% endif %}"
         href="{{ url_for('views.monitoring_panel') }}">
        <i data-lucide="activity" class="sidebar-icon" aria-hidden="true"></i>
        <span>Monitoring Panel</span>
      </a>

      <a class="sidebar-link {% if request.endpoint == 'views.manage_users' %}active{% endif %}"
         href="{{ url_for('views.manage_users') }}">
        <i data-lucide="users" class="sidebar-icon" aria-hidden="true"></i>
        <span>Manage Users</span>
      </a>

      <a class="sidebar-link {% if request.endpoint == 'views.reports' %}active{% endif %}"
         href="{{ url_for('views.reports') }}">
        <i data-lucide="file-text" class="sidebar-icon" aria-hidden="true"></i>
        <span>Reports</span>
      </a>

      <a class="sidebar-link {% if request.endpoint == 'views.inbox_admin' %}active{% endif %}"
         href="{{ url_for('views.inbox_admin') }}">
        <i data-lucide="bell" class="sidebar-icon" aria-hidden="true"></i>
        <span>Inbox</span>
        {% if unread_count and unread_count > 0 %}
          <span class="sidebar-badge">{{ unread_count }}</span>
        {% endif %}
      </a>

    </div>

    <!-- ===== ADMIN FOOTER USER PANEL ===== -->
    {% if current_user.is_authenticated %}
    <div class="sidebar-footer">

      {% set parts = (current_user.firstname or '').split() %}
      {% set first = parts[0] if parts|length > 0 else '' %}
      {% set last = parts[-1] if parts|length > 1 else '' %}
      {% set initials = (first[:1] ~ (last[:1] if last else (first[1:2] if first|length > 1 else ''))).upper() %}

      <div class="user-box" id="userBox">

        <div class="user-actions" id="userActions">
          <a class="user-action-link" href="{{ url_for('views.admin_profile') }}">My Profile</a>
          <a class="user-action-link" href="{{ url_for('auth.logout') }}">Logout</a>
        </div>

        <button class="user-trigger" type="button" id="userToggle">
          <div class="user-row">
            <div class="user-avatar">{{ initials }}</div>
            <div>
              <div class="user-name">{{ current_user.firstname }}</div>
              <div class="user-sub">Administrator</div>
            </div>
          </div>
          <div class="caret">â–¾</div>
        </button>

      </div>

    </div>
    {% endif %}

  </aside>

  <!-- ===== MAIN CONTENT ===== -->
  <main class="main-area">
    <div class="content-wrap">
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          <div class="flash-stack" aria-live="polite" aria-atomic="true">
            {% for category, message in messages %}
              <div class="flash-modern {% if category == 'error' %}flash-modern-error{% else %}flash-modern-success{% endif %}" role="alert">
                <div class="flash-modern-content">
                  <span class="flash-modern-dot"></span>
                  <span>{{ message }}</span>
                </div>
                <button type="button" class="flash-modern-close" aria-label="Close">&times;</button>
              </div>
            {% endfor %}
          </div>
        {% endif %}
      {% endwith %}

      {% block content %}{% endblock %}

    </div>
  </main>

</div>

<script>
  const userBox = document.getElementById("userBox");
  const userToggle = document.getElementById("userToggle");

  if(userToggle){
    userToggle.addEventListener("click", () => {
      userBox.classList.toggle("open");
    });

    document.addEventListener("click", function(e){
      if(!userBox.contains(e.target)){
        userBox.classList.remove("open");
      }
    });
  }
</script>

<script>
  window.addEventListener("DOMContentLoaded", () => {
    const flashes = document.querySelectorAll(".flash-modern");

    flashes.forEach((flash) => {
      flash.classList.add("is-visible");

      const closeBtn = flash.querySelector(".flash-modern-close");
      const dismiss = () => {
        flash.classList.add("is-hiding");
        setTimeout(() => flash.remove(), 450);
      };

      if (closeBtn) {
        closeBtn.addEventListener("click", dismiss);
      }

      setTimeout(dismiss, 4200);
    });
  });
</script>

<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
<script src="https://unpkg.com/lucide@latest"></script>
<script>
  lucide.createIcons();
</script>

</body>
</html>
